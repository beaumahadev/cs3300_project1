<html>

<head>
<script src="https://d3js.org/d3.v4.min.js"></script>
<style>
body { font-family: 'Crimson Text', Calibri, sans-serif; }
svg { border: solid #ccc 1px; }
path.lineGraph { fill: none; stroke-width: 2; }
</style>
</head>

	<body>

		<svg height="400" width="400"></svg>
		<svg width="960" height="600" id="map"></svg>
		<script src="https://d3js.org/d3.v4.min.js"></script>
		<script src="https://d3js.org/topojson.v2.min.js"></script>

		<script id = "Load Data">
			//All the code for loading from our tsv into arrys

			var satisfactionDict;
			var sleepDict;
			var incomeDict;
			var politicalDict;

			//creates a dictionary from given tsv given the colomn for the keys and the colomn for the values
			function createDataDict(tsv, col_key, col_value){ 
				var dict={};
				var newfunction= function(tsv, col_key, col_value){
					d3.tsv(tsv, function (error, data) {
					data.forEach(function(d) {
						var headings=Object.keys(d);
						dict[d[(headings[col_key])]]=d[(headings[col_value])];
					});
				});
					return dict;
				};
				return newfunction;
			}


			satisfactionDict=createDataDict()("hapiness.tsv",1,2);
			sleepDict=createDataDict()("sleep.tsv",0,1);
			incomeDict=createDataDict()("income.tsv",6,4);
			politicalDict=createDataDict()("political.tsv",0,1);


			  setTimeout(function() {
			    buildViz();
			  }, 250);

			

			//create the visulization 
			function buildViz(){
				console.log(politicalDict.Alabama);
				console.log(sleepDict.Alabama);


				showMap();

				//putting circles on test "scatterplot"
				var svg = d3.select("svg");
				for (var key in sleepDict){
					svg.append("circle")
					.attr("cx", Number(sleepDict[key]))
					.attr("cy",Number(sleepDict[key]))
					.attr("r", 6);

				}
			}

			function showMap(){
				
				var stateArray;
				
				var svg = d3.select("#map");

				var path = d3.geoPath();

				var sequentialColors = ['#edf8fb','#b2e2e2','#66c2a4','#2ca25f','#006d2c'];
				var scaleSleep = d3.scaleQuantize()
    .domain([50,72])
    .range(["#5E4FA2", "#3288BD", "#66C2A5", "#ABDDA4", "#E6F598", 
    "#FFFFBF", "#FEE08B", "#FDAE61", "#F46D43", "#D53E4F", "#9E0142"]);
				var x=0;
				var keys =  Object.keys(sleepDict);


				d3.json("https://d3js.org/us-10m.v1.json", function(error, us) {
				  if (error) throw error;

				  states = topojson.feature(us, us.objects.states);
				  stateArray=states.features;

				  svg.append("g")
				      .attr("class", "states")
				    .selectAll("path")
				    .data(topojson.feature(us, us.objects.states).features)
				    .enter().append("path")
				      .attr("d", path);

				  svg.append("path")
				      .attr("class", "state-borders")
				      .attr("d", path(topojson.mesh(us, us.objects.states, function(a, b) { return a !== b; })));


				 var paths = svg.selectAll("path");

				  paths
				  .style("fill", function (s) {
				    // Fill this in
				    	x=x+1;
				    	console.log(scaleSleep(25));
				      return scaleSleep(sleepDict[keys[x]]);
				  
				  })


				

				});


			}


			
</script>



</body>
</html>